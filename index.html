<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shawn's Website Library</title>
  <style>
    :root{
      --bg:#0f1115; --panel:#141619; --muted:#9aa0a6; --accent:#4da3ff; --card:#181a1d;
    }
    html,body{height:100%;margin:0;font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e8eef6;background:var(--bg)}
    header{display:flex;align-items:center;gap:.75rem;padding:.9rem 1rem;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-bottom:1px solid rgba(255,255,255,0.03)}
    header h1{font-size:1.05rem;margin:0}
    header .controls{margin-left:auto;display:flex;gap:.5rem;align-items:center}
    button.btn{background:var(--card);border:1px solid rgba(255,255,255,0.03);padding:.45rem .6rem;border-radius:8px;color:inherit;cursor:pointer}
    button.btn:hover{box-shadow:0 4px 18px rgba(0,0,0,0.4)}
    #container{display:flex;height:calc(100vh - 56px);overflow:hidden}
    #sidebar{width:260px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:1rem;box-sizing:border-box;border-right:1px solid rgba(255,255,255,0.02);overflow:auto;transition:transform .28s ease}
    #sidebar.hidden{transform:translateX(-100%)}
    #nav h2{margin:0;padding:.5rem 0;cursor:pointer;display:flex;align-items:center;gap:.5rem}
    #nav ul{list-style:none;padding-left:1rem;margin:0 0 1rem 0;display:none}
    #nav li{margin:.35rem 0}
    #nav a{color:var(--accent);text-decoration:none}
    #main{flex:1;overflow:auto;padding:1rem;box-sizing:border-box}
    section.card{background:var(--panel);padding:1rem;border-radius:12px;margin-bottom:1rem;border:1px solid rgba(255,255,255,0.03)}
    .site-item{padding:.6rem 0;border-bottom:1px dashed rgba(255,255,255,0.03)}
    .site-item:last-child{border-bottom:none}
    .site-item a{font-weight:600;color:var(--accent);text-decoration:none}
    .site-desc{color:var(--muted);margin:.3rem 0;font-size:.95rem}

    /* password modal */
    .overlay{
      position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,0.55);backdrop-filter:blur(4px);z-index:9999;
    }
    .modal{
      width:min(520px,92vw);background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:14px;padding:1.2rem;border:1px solid rgba(255,255,255,0.04);box-shadow:0 8px 30px rgba(0,0,0,0.6);}
    .modal h2{margin:0 0 .6rem 0}
    .modal p{margin:.2rem 0 .8rem 0;color:var(--muted)}
    .modal .row{display:flex;gap:.5rem}
    .modal input{flex:1;padding:.6rem .7rem;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;font-size:1rem}
    .modal .error{color:#ff7b7b;margin-top:.5rem;font-size:.92rem;min-height:1.1em}
    .modal .small{font-size:.85rem;color:var(--muted);margin-top:.6rem}

    @media (max-width:820px){
      #sidebar{position:fixed;left:0;top:56px;height:calc(100vh - 56px);z-index:40;box-shadow:8px 0 20px rgba(0,0,0,0.6)}
      #main{padding:.8rem}
    }
  </style>
</head>
<body>
  <header>
    <button id="toggleBtn" class="btn">☰</button>
    <h1>Shawn's Website Library · 赵涵绍的网站库</h1>
    <div class="controls">
      <button id="lockBtn" class="btn" title="Lock site">🔓 Unlock</button>
    </div>
  </header>

  <div id="container">
    <aside id="sidebar">
      <nav id="nav" aria-label="Categories"></nav>
    </aside>

    <main id="main" tabindex="-1">
      <div id="content" aria-live="polite"></div>
    </main>
  </div>

  <!-- Password overlay -->
  <div id="passwordOverlay" class="overlay" style="display:none" aria-hidden="false">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="pwdTitle">
      <h2 id="pwdTitle">请输入访问密码</h2>
      <p>为保护此站内容，请输入密码以继续访问。</p>

      <div class="row">
        <input id="pwdInput" type="password" inputmode="numeric" placeholder="输入密码" aria-label="密码" />
        <button id="pwdSubmit" class="btn">提交</button>
      </div>

      <div class="error" id="pwdError" aria-live="polite"></div>
      <div class="small">（提示：页面会记住本次解锁状态。若不想被记住，点顶部 Lock 按钮重新上锁。）</div>
    </div>
  </div>

  <script>
    /*********************************************************
     * 数据区：把你的网站/分类放在这里（可直接修改）
     *********************************************************/
    const data = {
      "categories": [
        {
          "title": "常用工具",
          "items": [
            { "title": "ScanQR", "url": "https://scanqr.org", "desc": "在线二维码生成和扫描工具" },
            { "title": "Z-Library", "url": "https://z-library.sk", "desc": "电子书下载网站" },
            { "title": "FreeCompress", "url": "https://freecompress.com", "desc": "文件压缩工具" },
            { "title": "Documentary Heaven", "url": "https://www.documentaryheaven.com", "desc": "在线观看纪录片" },
            { "title": "Convertio", "url": "https://convertio.co", "desc": "文件格式转换工具" }
          ]
        },
        {
          "title": "剪辑 / 音乐",
          "items": [
            { "title": "ScanQR", "url": "https://scanqr.org", "desc": "在线二维码生成和扫描工具" },
            { "title": "SaveFrom.net", "url": "https://zh.savefrom.net", "desc": "免费视频和音乐下载工具" },
            { "title": "Free Music Archive", "url": "https://freemusicarchive.org", "desc": "免费、可合法下载的音乐资源库" },
            { "title": "Pixabay Music", "url": "https://pixabay.com/music/", "desc": "免版权音乐下载" }
          ]
        },
        {
          "title": "学习",
          "items": [
            { "title": "Alpha One 学习挑战", "url": "https://www.notion.so/Alpha-One-1e876d36cebb80558886c9b3972bbf74", "desc": "精英中学月度模拟考试挑战" },
            { "title": "Z-Library", "url": "https://z-library.sk", "desc": "电子书下载网站" }
          ]
        },
        {
          "title": "娱乐",
          "items": [
            { "title": "图寻 - 探索世界", "url": "https://tuxun.fun", "desc": "探索世界的地图类娱乐网站" },
            { "title": "Polytrack", "url": "https://polytrack.run", "desc": "在线赛车与驾驶类游戏" }
          ]
        },
        {
          "title": "大全",
          "items": [
            { "title": "Books / Comics / Manga (FMHY)", "url": "https://fmhy.net", "desc": "电子书、漫画、轻小说等资源站合集" }
          ]
        },
        {
          "title": "软件下载",
          "items": [
            { "title": "VAAB App 下载站", "url": "http://app.vaab.asia/pRTkrJf3PV", "desc": "提供软件下载的资源站" },
            { "title": "P&SJ 文档资源", "url": "https://docs.qq.com/doc/DWk5MTlBLSWxuSFRk", "desc": "软件说明与下载文档" }
          ]
        }
      ]
    };

    /*********************************************************
     * 密码哈希配置（在源码里仅保存 SHA-256 哈希）
     * 你当前的密码是 910729 -> 其 SHA-256 十六进制为：
     * d303549d060022e41b62cef071b46e7c1745ce5bb224c7667acfacdf8becac8e
     *
     * 如果你想改密码，请在本地运行：
     *   echo -n "新密码" | shasum -a 256 | awk '{print $1}'
     * 然后把输出字符串替换下面的 STORED_HASH_HEX。
     *********************************************************/
    const STORED_HASH_HEX = "d303549d060022e41b62cef071b46e7c1745ce5bb224c7667acfacdf8becac8e";
    const STORAGE_KEY = "shawn_site_unlocked_v1"; // 本地保存已解锁状态

    /*********************************************************
     * DOM 元素引用
     *********************************************************/
    const overlay = document.getElementById("passwordOverlay");
    const pwdInput = document.getElementById("pwdInput");
    const pwdSubmit = document.getElementById("pwdSubmit");
    const pwdError = document.getElementById("pwdError");
    const lockBtn = document.getElementById("lockBtn");
    const toggleBtn = document.getElementById("toggleBtn");
    const sidebar = document.getElementById("sidebar");
    const nav = document.getElementById("nav");
    const content = document.getElementById("content");

    /*********************************************************
     * 辅助：SHA-256（Web Crypto API），返回 hex 字符串
     *********************************************************/
    async function sha256Hex(str){
      const enc = new TextEncoder().encode(String(str));
      const buf = await crypto.subtle.digest('SHA-256', enc);
      const arr = Array.from(new Uint8Array(buf));
      return arr.map(b=>b.toString(16).padStart(2,"0")).join("");
    }

    /*********************************************************
     * 渲染 UI：侧栏（可折叠） + 右侧内容
     *********************************************************/
    function buildUI(){
      nav.innerHTML = "";
      content.innerHTML = "";
      data.categories.forEach(cat => {
        // nav
        const title = document.createElement("h2");
        title.textContent = "▸ " + cat.title;
        title.setAttribute("role","button");
        title.tabIndex = 0;
        const ul = document.createElement("ul");
        cat.items.forEach(it=>{
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.textContent = it.title;
          a.href = "#"+slug(it.title);
          li.appendChild(a);
          ul.appendChild(li);
        });
        title.addEventListener("click", ()=> toggleList(title, ul));
        title.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") toggleList(title,ul); });
        nav.appendChild(title);
        nav.appendChild(ul);

        // main content
        const sec = document.createElement("section");
        sec.className = "card";
        const h2 = document.createElement("h2");
        h2.textContent = cat.title;
        sec.appendChild(h2);
        cat.items.forEach(it=>{
          const div = document.createElement("div");
          div.className = "site-item";
          div.id = slug(it.title);
          div.innerHTML = `<a href="${escapeHtml(it.url)}" target="_blank" rel="noopener">${escapeHtml(it.title)}</a>
                           <div class="site-desc">${escapeHtml(it.desc||"")}</div>`;
          sec.appendChild(div);
        });
        content.appendChild(sec);
      });
    }

    function escapeHtml(s){ return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }
    function slug(s){ return String(s).toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]+/g,"-").replace(/(^-|-$)/g,""); }
    function toggleList(title, ul){
      const open = ul.style.display === "block";
      ul.style.display = open? "none" : "block";
      title.textContent = (open? "▸ " : "▾ ") + title.textContent.slice(2);
    }

    /*********************************************************
     * 密码遮罩控制（SHA-256 比对）
     *********************************************************/
    function showOverlay(){ overlay.style.display = "flex"; overlay.setAttribute("aria-hidden","false"); document.body.style.overflow = "hidden"; pwdInput.value = ""; pwdError.textContent = ""; pwdInput.focus(); lockBtn.textContent = "🔒 Lock"; }
    function hideOverlay(){ overlay.style.display = "none"; overlay.setAttribute("aria-hidden","true"); document.body.style.overflow = ""; pwdError.textContent = ""; lockBtn.textContent = "🔓 Unlock"; }

    async function tryUnlockWithInput(){
      const v = pwdInput.value.trim();
      if(!v){ pwdError.textContent = "请输入密码。"; pwdInput.focus(); return; }
      pwdError.textContent = "";
      pwdSubmit.disabled = true;
      try{
        const h = await sha256Hex(v);
        if(h === STORED_HASH_HEX){
          localStorage.setItem(STORAGE_KEY, "true");
          hideOverlay();
        } else {
          pwdError.textContent = "密码错误，请重试。";
          pwdInput.focus();
        }
      }catch(err){
        pwdError.textContent = "发生错误，请重试。";
        console.error(err);
      } finally {
        pwdSubmit.disabled = false;
      }
    }

    pwdSubmit.addEventListener("click", tryUnlockWithInput);
    pwdInput.addEventListener("keydown", (e)=>{ if(e.key==="Enter") tryUnlockWithInput(); });

    /*********************************************************
     * 初始化：构建 UI 并根据 localStorage 决定是否显示遮罩
     *********************************************************/
    function init(){
      buildUI();

      // 侧边栏收起状态记忆（可改，这里做一个简单默认展开）
      // 侧边栏整体可收起/展开
      toggleBtn.addEventListener("click", ()=>{
        sidebar.classList.toggle("hidden");
        localStorage.setItem("sidebarHidden", sidebar.classList.contains("hidden") ? "1" : "0");
      });
      if(localStorage.getItem("sidebarHidden")==="1") sidebar.classList.add("hidden");

      // lock 按钮：重新上锁（删除 localStorage）
      lockBtn.addEventListener("click", ()=>{
        localStorage.removeItem(STORAGE_KEY);
        showOverlay();
      });

      // 如果已解锁则隐藏遮罩，否则显示
      if(localStorage.getItem(STORAGE_KEY) === "true"){
        hideOverlay();
      } else {
        showOverlay();
      }

      // keyboard shortcut: '/' focus password when locked, else focus search area if any
      window.addEventListener("keydown", (e)=>{
        if(e.key === "/" && document.activeElement !== pwdInput){
          e.preventDefault();
          if(overlay.style.display !== "none"){
            pwdInput.focus();
          }
        }
      });
    }

    // run
    init();

  </script>
</body>
</html>
