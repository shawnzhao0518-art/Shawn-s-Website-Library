<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shawn's Website Library</title>
  <style>
    /* 保持原有样式 */
    html { font-size: clamp(14px, 1.35vw + 0.5px, 18px); box-sizing: border-box; }
    *, *::before, *::after { box-sizing: inherit; }
    :root{
      --bg:#0f1115; --panel:#141619; --muted:#9aa0a6; --accent:#4da3ff; --card:#181a1d;
      --radius: 0.75rem;
    }
    html,body{height:100%;margin:0;font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e8eef6;background:var(--bg);-webkit-font-smoothing:antialiased;}
    header{display:flex;align-items:center;gap:0.75rem;padding:0.9rem 1rem;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-bottom:1px solid rgba(255,255,255,0.03)}
    header h1{font-size:1.05rem;margin:0}
    header .controls{margin-left:auto;display:flex;gap:0.5rem;align-items:center}
    button.btn{background:var(--card);border:1px solid rgba(255,255,255,0.03);padding:0.45rem 0.6rem;border-radius:0.5rem;color:inherit;cursor:pointer;font-size:1rem}
    button.btn:hover{box-shadow:0 0.25rem 1.125rem rgba(0,0,0,0.4)}
    #container{display:flex;height:calc(100vh - 3.5rem);overflow:hidden}
    #sidebar{width:16.25rem;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:1rem;box-sizing:border-box;border-right:1px solid rgba(255,255,255,0.02);overflow:auto;transition:transform .28s ease}
    #sidebar.hidden{transform:translateX(-100%)}
    #nav h2{margin:0;padding:0.5rem 0;cursor:pointer;display:flex;align-items:center;gap:0.5rem;font-size:1rem}
    #nav ul{list-style:none;padding-left:1rem;margin:0 0 1rem 0;display:none}
    #nav li{margin:0.35rem 0}
    #nav a{color:var(--accent);text-decoration:none;font-size:0.95rem}
    #main{flex:1;overflow:auto;padding:1rem;box-sizing:border-box}
    section.card{background:var(--panel);padding:1rem;border-radius:0.75rem;margin-bottom:1rem;border:1px solid rgba(255,255,255,0.03)}
    .site-item{padding:0.6rem 0;border-bottom:1px dashed rgba(255,255,255,0.03)}
    .site-item:last-child{border-bottom:none}
    .site-item a{font-weight:600;color:var(--accent);text-decoration:none;font-size:1rem}
    .site-desc{color:var(--muted);margin:0.3rem 0;font-size:0.95rem}
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.55);backdrop-filter:blur(4px);z-index:9999;}
    .modal{width:min(520px,92vw);background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:0.875rem;padding:1.2rem;border:1px solid rgba(255,255,255,0.04);box-shadow:0 0.5rem 2rem rgba(0,0,0,0.6);}
    .modal h2{margin:0 0 0.6rem 0;font-size:1.05rem}
    .modal p{margin:0.2rem 0 0.8rem 0;color:var(--muted);font-size:0.95rem}
    .modal .row{display:flex;gap:0.5rem}
    .modal input{flex:1;padding:0.6rem 0.7rem;border-radius:0.5rem;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;font-size:1rem}
    .modal .error{color:#ff7b7b;margin-top:0.5rem;font-size:0.95rem;min-height:1.1em}
    .modal .small{font-size:0.85rem;color:var(--muted);margin-top:0.6rem}
    @media (max-width:820px){
      #sidebar{position:fixed;left:0;top:3.5rem;height:calc(100vh - 3.5rem);z-index:40;box-shadow:8px 0 20px rgba(0,0,0,0.6)}
      #main{padding:0.8rem}
    }
    a { word-break: break-word; }
  </style>
</head>
<body>
  <header>
    <button id="toggleBtn" class="btn" aria-label="Toggle sidebar">☰</button>
    <h1 id="pageTitle">Shawn's Website Library</h1>
    <div class="controls">
      <button id="langBtn" class="btn" title="Switch language">🌐 English</button>
      <button id="lockBtn" class="btn" title="Lock site">🔓 Unlock</button>
    </div>
  </header>

  <div id="container">
    <aside id="sidebar"><nav id="nav"></nav></aside>
    <main id="main"><div id="content"></div></main>
  </div>

  <!-- 密码弹窗 -->
  <div id="passwordOverlay" class="overlay" style="display:none" aria-hidden="false">
    <div class="modal">
      <h2>请输入访问密码</h2>
      <p>为保护此站内容，请输入密码以继续访问。</p>
      <div class="row">
        <input id="pwdInput" type="password" placeholder="输入密码" />
        <button id="pwdSubmit" class="btn">提交</button>
      </div>
      <div class="error" id="pwdError"></div>
      <div class="small">（提示：页面会记住解锁状态。点击 Lock 按钮可重新上锁。）</div>
    </div>
  </div>

  <script>
    /*********************************************************
     * 数据区：完整中英文版本（省略展示，和之前一样）
     *********************************************************/
    const data = { /* ← 用我之前发给你的六大分类完整 JSON */ };

    const STORAGE_KEY = "shawn_site_unlocked_v1";
    const LANG_KEY = "shawn_site_lang"; // 新增：存储语言选择
    const STORED_HASH_HEX = "d303549d060022e41b62cef071b46e7c1745ce5bb224c7667acfacdf8becac8e"; // 910729

    const overlay = document.getElementById("passwordOverlay");
    const pwdInput = document.getElementById("pwdInput");
    const pwdSubmit = document.getElementById("pwdSubmit");
    const pwdError = document.getElementById("pwdError");
    const lockBtn = document.getElementById("lockBtn");
    const toggleBtn = document.getElementById("toggleBtn");
    const sidebar = document.getElementById("sidebar");
    const nav = document.getElementById("nav");
    const content = document.getElementById("content");
    const pageTitle = document.getElementById("pageTitle");
    const langBtn = document.getElementById("langBtn");

    // 如果有存储过语言，优先使用；否则第一次默认英文
    let currentLang = localStorage.getItem(LANG_KEY) || "en";

    function escapeHtml(s){ return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }
    function slug(s){ return String(s).toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]+/g,"-").replace(/(^-|-$)/g,""); }

    function buildUI(){
      nav.innerHTML = ""; content.innerHTML = "";
      data.categories.forEach(cat=>{
        const title = document.createElement("h2");
        title.textContent = "▸ " + cat.title[currentLang];
        const ul = document.createElement("ul");
        cat.items.forEach(it=>{
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.textContent = it.title[currentLang];
          a.href = "#"+slug(it.title[currentLang]);
          li.appendChild(a); ul.appendChild(li);
        });
        nav.appendChild(title); nav.appendChild(ul);

        const sec=document.createElement("section"); sec.className="card";
        const h2=document.createElement("h2"); h2.textContent=cat.title[currentLang]; sec.appendChild(h2);
        cat.items.forEach(it=>{
          const div=document.createElement("div"); div.className="site-item"; div.id=slug(it.title[currentLang]);
          div.innerHTML=`<a href="${escapeHtml(it.url)}" target="_blank">${escapeHtml(it.title[currentLang])}</a>
                         <div class="site-desc">${escapeHtml(it.desc[currentLang])}</div>`;
          sec.appendChild(div);
        });
        content.appendChild(sec);
      });

      // 设置标题和按钮
      if(currentLang==="zh"){
        pageTitle.textContent = "Shawn's Website Library · 赵涵绍的网站库";
        langBtn.textContent = "🌐 中文";
      } else {
        pageTitle.textContent = "Shawn's Website Library";
        langBtn.textContent = "🌐 English";
      }
    }

    // 切换语言
    langBtn.addEventListener("click", ()=>{
      currentLang = currentLang==="zh" ? "en" : "zh";
      localStorage.setItem(LANG_KEY, currentLang); // 记住选择
      buildUI();
    });

    // 密码逻辑
    async function sha256Hex(str){
      const enc = new TextEncoder().encode(String(str));
      const buf = await crypto.subtle.digest('SHA-256', enc);
      const arr = Array.from(new Uint8Array(buf));
      return arr.map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    function showOverlay(){ overlay.style.display="flex"; pwdInput.value=""; pwdError.textContent=""; lockBtn.textContent="🔒 Lock"; }
    function hideOverlay(){ overlay.style.display="none"; pwdError.textContent=""; lockBtn.textContent="🔓 Unlock"; }
    async function tryUnlockWithInput(){
      const v = pwdInput.value.trim();
      if(!v){ pwdError.textContent="请输入密码。"; return; }
      const h = await sha256Hex(v);
      if(h===STORED_HASH_HEX){ localStorage.setItem(STORAGE_KEY,"true"); hideOverlay(); }
      else { pwdError.textContent="密码错误，请重试。"; }
    }
    pwdSubmit.addEventListener("click", tryUnlockWithInput);
    pwdInput.addEventListener("keydown",(e)=>{ if(e.key==="Enter") tryUnlockWithInput(); });

    function init(){
      buildUI();
      toggleBtn.addEventListener("click",()=>{ sidebar.classList.toggle("hidden"); });
      lockBtn.addEventListener("click",()=>{ localStorage.removeItem(STORAGE_KEY); showOverlay(); });
      if(localStorage.getItem(STORAGE_KEY)==="true"){ hideOverlay(); } else { showOverlay(); }
    }
    init();
  </script>
</body>
</html>
